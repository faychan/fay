@model fay.Models.ViewModel.addOrderView
@{
    ViewBag.Title = "Add";
    Layout = "~/Views/_Base/_index.cshtml";
}
<h2>Add</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>addOrderView</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.outbondID, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @using fay.Models.DB;
                @using fay;
                @using fay.Models.EntityManager;
                @using fay.Models.ViewModel;
                @{
                    List<Orderoutbond> orderoutbond = new List<Orderoutbond>();
                    using (RestoDBEntities db = new RestoDBEntities())
                    {
                        foreach (outbond outbond in db.outbonds)
                        {
                            Orderoutbond om = new Orderoutbond();
                            if (outbond.Stock == 0)
                            {
                                om.Text = outbond.outbondID + " - " + outbond.Nama + " (Stock Empty!)";
                            }
                            else
                            {
                                om.Text = outbond.outbondID + " - " + outbond.Nama;
                            }
                            om.Value = outbond.outbondID.ToString();
                            orderoutbond.Add(om);
                        }
                    }
                }
                @Html.DropDownListFor(model => model.outbondID, new SelectList(orderoutbond, "Value", "Text"), "", new { @class = "form-control", @id = "outbondList" })
                @Html.ValidationMessageFor(model => model.outbondID, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.PelangganID, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @{
                    List<OrderUser> orderUser = new List<OrderUser>();
                    using (RestoDBEntities db = new RestoDBEntities())
                    {
                        foreach (Pelanggan p in db.Pelanggans)
                        {
                            OrderUser ou = new OrderUser();
                            ou.Text = p.NoID + " - " + p.Nama;
                            ou.Value = p.PelangganID.ToString();
                            orderUser.Add(ou);
                        }
                    }
                }
                @Html.DropDownListFor(model => model.PelangganID, new SelectList(orderUser, "Value", "Text"), "", new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.PelangganID, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Keterangan, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Keterangan, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Keterangan, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Meja, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Meja, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Meja, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Quantity, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="">
                <div class="col-md-9">
                    @Html.EditorFor(model => model.Quantity, new { htmlAttributes = new { @id = "orderQuantity", @readonly = "readonly", @class = "form-control quantityData" } })
                @Html.ValidationMessageFor(model => model.Quantity, "", new { @class = "text-danger" })
            </div>
            <div class="col-md-1">
                <a class="linkPlz" href="javascript:void(0);">
                    <span class="glyphicon glyphicon-minus quantityMin"></span>
                </a>
                <a class="linkPlz" href="javascript:void(0);">
                    <span class="glyphicon glyphicon-plus quantityPlus"></span>
                </a>
            </div>

        </div>

    </div>
    <div class="form-group">
        @Html.LabelFor(model => model.Harga, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Harga, new { htmlAttributes = new { @id = "orderHarga", @readonly = "readonly", @class = "form-control" } })
            @Html.ValidationMessageFor(model => model.Harga, "", new { @class = "text-danger" })
        </div>
    </div>
    <div class="form-group">
        @Html.LabelFor(model => model.Jumlah, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Jumlah, new { htmlAttributes = new { @id = "orderTotal", @readonly = "readonly", @class = "form-control" } })
            @Html.ValidationMessageFor(model => model.Jumlah, "", new { @class = "text-danger" })
        </div>
    </div>
    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" value="Create" class="btn btn-default" />
        </div>
    </div>
</div>
                    }
<div>
    @Html.ActionLink("Back to List", "Index")
</div>
<script>

    var jsonOutput;
    var harga;
    var jumlahStock;
    $("#outbondList").change(function () {
        console.log($("#outbondList").val())
        $.ajax({
            type: "POST",
            url: "@Url.Action("GetoutbondData","Order")",
            data: {
                outbondID: $("#outbondList").val()
            },
            success: function (data) {
                jsonOutput = data;
                harga = jsonOutput.harga;
                jumlahStock = jsonOutput.);
                if (jumlahStock != 0) {
                    $("#orderHarga").val(harga);
                    $("#orderQuantity").val(1);
                    amountCounter = 1;
                } else {
                    $("#orderHarga").val(harga);
                    $("#orderQuantity").val(0);
                    amountCounter = 0;
                }
                var q = parseInt($("#orderQuantity").val());
                console.log(q);
                var t = harga * q;
                $("#orderTotal").val(t);
            },
            error: function (error) {
                console.log("Data Fetch Failed!");
            }

        });
    });

    var amountCounter = 0;
    $("span.quantityMin").click(function () {
        if ($("input.quantityData").val() != 0) {
            amountCounter -= 1;
            $("input.quantityData").val(amountCounter);
            var q = parseInt($("#orderQuantity").val());
            console.log(q);
            var t = harga * q;
            $("#orderTotal").val(t);
        }
    });
    $("span.quantityPlus").click(function () {
        var temp = amountCounter + 1;
        if (temp > jumlahStock) {
            console.log("Too Much!")
        } else {
            amountCounter += 1;
            $("input.quantityData").val(amountCounter);
            var q = parseInt($("#orderQuantity").val());
            console.log(q);
            var t = harga * q;
            $("#orderTotal").val(t);
        }
    });
</script>
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
